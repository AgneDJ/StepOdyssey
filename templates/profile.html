{% extends 'base.html' %}
{% include 'friend_request.html' %}
{% include 'Invite_to_challenge.html' %}
{% block content %}
     
        Hi {{user.user_name}}! Welcome to Step Odyssey!
       
        <div class="rounded-circle shadow-4">
            <img id="myImg" src="{{user.user_avatar}}" class="rounded-circle shadow-4" style="width: 100px;" alt="Avatar" />
        </div>
        <br>
        

        <form action="/sync">
            <button type="submit" class="btn btn-primary">Sync data</button>
        </form>
        <form action="/logout">
            <button type="submit" class="btn btn-primary">Log out</button>
        </form>
        <div class="container">

            <table class="table table-dark">
                <thead>
                    <tr>
                        <th scope="col">Daily Total Steps</th>
                        <th scope="col">Lifetime Steps</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td scope="col">{{date}} - {{daily_total}}</td>
                        <td scope="col">{{lifetime_steps}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="container">
            {% if user_achievements %}
            <div class="row">
                <br>
                <h1>Your achievements</h1>
                <br>
            </div>
            <div class="row">
                <div id = "Achievements"></div>
                    <table class="table table-dark">
                        <thead>
                            {% for user_achievement in user_achievements %}
                            <tr>
                                <td scope="col"><img src={{user_achievement.achievements.image}} class="rounded-circle shadow-4" style="width: 100px;" alt="Achievements image"></td>
                                <td scope="col">{{user_achievement.achievements.title}}</td>
                            </tr>
                            {% endfor %}
                        </thead>
                    </table>
            {% endif %}
        </div> 

        <div class="container">
                <div class="row">
                    <br>
                    <h1>Your Challenges</h1>
                    <br>
                </div>
                <div id = "Challenges">
                    <table class="table table-dark">
                        <thead>
                            <tr>
                                <th scope="col">Title</th>
                                <th scope="col">Progress</th>
                                <th scope="col">Position</th>
                                <th scope="col">Duration</th>
                                <th scope="col">Status</th>
                                <th scope="col">Invite</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in user_challenges %}
                            <tr>
                                <td scope="col">{{row['user_challenge'].challenges.title}}</td>
                                <td scope="col">{{row['progress']}}</td>
                                <td scope="col">{{row['complete']}}</td>
                                <td scope="col">{{row['duration']}}</td>
                                <td scope="col">{{row['status']}}</td>
                            </tr>
                        </tbody>
                    </table> 
                    <br>
                    <div>
                    {% for user in friends_list %}
                        {% if row['status'] == "In progress" %}
                        <td scope="col">
                        <div class="col-sm-1">
                            <div class="dropdown">
                                <button class="dropbtn">Invite Friends</button>
                                <div class="dropdown-content">
                                    <td scope="col"><button class="btn btn-outline-success my-2 my-sm-0" id="inviting-{{user.user_id}}-{{row['user_challenge'].challenges.challenge_id}}" type="submit"><a href="#">{{user.user_name}}</a></button></td>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        </td>
                    </div>
                    <br>
                        {% if row['friends'] %}
                    <table class="table table-dark">
                        <thead>
                            <tr>
                                <th scope="col">Friend</th>
                                <th scope="col">Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for state in row['friends'] %}
                            <tr>
                                <td scope="col">{{state['friend'].user_name}}</td>
                                <td scope="col">{{state['steps']}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                        {% endif %}
                            {% endfor %}
                    </div>  
                {% endfor %}  
                  
                </div>  
            </div>
        </div>

        <script type="text/javascript">
        //     window.addEventListener('load', function() {document.querySelector('input[type="file"]').addEventListener('change', function() {
        //         let img = document.querySelector('.avatar');   
        //         console.log("0000000000000000000"+ img) 
        //         if (this.files && this.files[0]) {
        //             img.onload = () => {
        //                 URL.revokeObjectURL(img.src);
        //             };
        //             img.src = URL.createObjectURL(this.files[0]); 
        //         }
        //     });
        // });
    </script>
    <script src="/static/invite.js"></script>
       
{% endblock %} 
